<div class="component" ng-if="vm.patientResults.length > 0">
  <h1>Query results</h1>
  <div ng-repeat="query in vm.patientResults track by $index" class="animated fadeIn">
    <h2>Patient Information</h2>
    <table class="table">
      <thead>
        <tr>
          <th scope="cols">Field</th>
          <th scope="cols">Value</th>
        </tr>
      </thead>
      <tfoot>
        <tr>
          <td colspan="2"><a href ng-click="query.showResults = !query.showResults">{{ query.showResults ? 'Hide' : 'Show'}} {{ query.results.length }} result<span ng-if="query.results.length > 1">s</span></a></td>
        </tr>
      </tfoot>
      <tbody>
        <tr ng-if="query.query.patientId">
          <td>Patient ID</td>
          <td>{{ query.query.patientId }}</td>
        </tr>
        <tr ng-if="query.query.firstName">
          <td>firstName</td>
          <td>{{ query.query.firstName }}</td>
        </tr>
        <tr ng-if="query.query.lastName">
          <td>Last Name</td>
          <td>{{ query.query.lastName }}</td>
        </tr>
        <tr ng-if="query.query.dob">
          <td>DOB</td>
          <td>{{ query.query.dob | date : 'mediumDate' : 'UTC' }}</td>
        </tr>
        <tr ng-if="query.query.gender">
          <td>Gender</td>
          <td>{{ query.query.gender }}</td>
        </tr>
        <tr ng-if="query.query.ssn">
          <td>SSN</td>
          <td>{{ query.query.ssn }}</td>
        </tr>
        <tr ng-if="query.query.homeZip">
          <td>Home Zip</td>
          <td>{{ query.query.homeZip }}</td>
        </tr>
      </tbody>
    </table>
    <div ng-if="query.showResults" class="">
      <h2>Results</h2>
      <table class="table">
        <thead>
          <tr>
            <th scope="cols">First name</th>
            <th scope="cols">Last name</th>
            <th scope="cols" ng-if="query.results.length > 1">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat-start="patient in query.results">
            <td>{{ patient.firstName }}</td>
            <td>{{ patient.lastName }}</td>
            <td ng-if="query.results.length > 1"><button class="btn btn-success btn-block" ng-click="vm.queryPatientDocuments(patient, $parent.$parent.$index)">Select patient <i class="fa fa-check"></i></button>
              <!--
                  {{ patient.id + '-' + $parent.$parent.$index }}
                -->
            </td>
          </tr>
          <tr ng-repeat-end ng-if="patient.documents && patient.documents.length > 0">
            <td colspan="{{ query.results.length > 1 ? 3 : 2}}">Available documents
              <ul class="list-unstyled">
                <li ng-repeat="doc in patient.documents">
                  <button ng-if="doc.status !== 'cached'" ng-click="vm.getDocument(patient, doc)" class="btn btn-success btn-sm"><span class="sr-only">Download</span><i class="fa fa-download"></i></button>
                  <button ng-if="doc.status === 'cached'" ng-click="vm.activateDocument(doc)" class="btn btn-success btn-sm"><span class="sr-only">View</span><i class="fa fa-eye"></i></button>
                  <strong>Title:</strong> {{ doc.title }} (<strong>Type:</strong> {{ doc.filetype }})
                </li>
              </ul>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
