<div class="patient-search container-fluid">
  <div class="form-horizontal" ng-form="vm.queryForm">
    <div class="panel panel-primary">
      <div class="panel-heading">
        <div class="pull-right">
          <button class="btn btn-sm panel-button" ng-click="vm.hidePanel = !vm.hidePanel"><i class="fa fa-lg {{ vm.hidePanel ? 'fa-caret-right' : 'fa-caret-down' }}"></i><span class="sr-only">{{ vm.hidePanel ? 'Show' : 'Hide' }} Panel</span></button>
        </div>
        <h2 class="panel-title">Patient Query</h2>
        <div class="clearfix"></div>
      </div>
      <div class="panel-body slide" ng-if="!vm.hidePanel">
        <div class="form-group">
          <label class="col-sm-2 control-label">Name<span ng-if="vm.query.patientNames && vm.query.patientNames.length !== 1">s</span> <span class="text-danger">*</span></label>
          <div class="col-sm-10">
            <ai-names names="vm.query.patientNames"
                      active-form="vm.queryForm"
                      show-form-errors="vm.showFormErrors"
                      submit-form="vm.searchForPatient"></ai-names>
          </div>
        </div>
        <div class="form-group">
          <div ng-class="{ 'has-error' : (vm.showFormErrors || vm.queryForm.gender.$touched) && vm.queryForm.gender.$error.required }">
            <label for="gender" class="col-sm-2 control-label">Gender <span class="text-danger">*</span></label>
            <div class="col-sm-4">
              <select class="input-sm form-control" ng-model="vm.query.gender" id="gender" name="gender" ng-keyup="$event.keyCode == 13 && !vm.queryForm.$invalid && vm.searchForPatient()" required>
                <option value="F">Female</option>
                <option value="M">Male</option>
                <option value="UN">Undifferentiated</option>
              </select>
              <span class="text-danger" ng-if="(vm.showFormErrors || vm.queryForm.gender.$touched) && vm.queryForm.gender.$error.required">Field is required</span>
            </div>
          </div>
          <div ng-class="{ 'has-error' : (vm.showFormErrors || vm.queryForm.dob.$touched) && (!vm.queryForm.dob.$valid || vm.queryForm.dob.$error.required) }">
            <label for="dob" class="col-sm-2 control-label">Date of Birth <span class="text-danger">*</span></label>
            <div class="col-sm-4">
              <input class="input-sm form-control" type="text" ng-model="vm.query.dob" placeholder="yyyyMMddHHmmss+/-ZZZZ"
                     ng-pattern="/^\d{4}([01]\d([0-3]\d([0-2]\d([0-5]\d([0-5]\d)?)?)?)?)?([+-][0-2]\d[0-5]\d)?$/"
                     uib-tooltip="yyyyMMddHHmmss+/-ZZZZ" tooltip-trigger="mouseenter focus click"
                     id="dob" name="dob" ng-keyup="$event.keyCode == 13 && !vm.queryForm.$invalid && vm.searchForPatient()" required>
              <span class="text-danger" ng-if="(vm.showFormErrors || vm.queryForm.dob.$touched) && !vm.queryForm.dob.$error.required && !vm.queryForm.dob.$valid">Required format: yyyy[MM[dd[hh[mm[ss]]]]][+/-zzzz]</span>
              <span class="text-danger" ng-if="(vm.showFormErrors || vm.queryForm.dob.$touched) && vm.queryForm.dob.$error.required">Field is required</span>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12">
            <button type="button" class="btn btn-default" ng-click="vm.showOptional = !vm.showOptional">{{ vm.showOptional ? 'Hide' : 'Show' }} optional search items <i class="fa fa-search"></i></button>
          </div>
        </div>
        <div ng-if="vm.showOptional">
          <div class="form-group">
            <div ng-class="{ 'has-error' : ((vm.showFormErrors && vm.queryForm.$touched) || vm.queryForm.ssn.$touched) && vm.queryForm.ssn.$error.pattern }">
              <label for="ssn" class="col-sm-2 control-label">SSN</label>
              <div class="col-sm-4">
                <input class="input-sm form-control" type="text" ng-model="vm.query.ssn" id="ssn" name="ssn"
                       uib-tooltip="XXX-XX-XXXX" tooltip-trigger="mouseenter focus click"
                       placeholder="XXX-XX-XXXX" pattern="(\d{3}-?\d{2}-?\d{4})" ng-keyup="$event.keyCode == 13 && !vm.queryForm.$invalid && vm.searchForPatient()">
                <div class="text-danger" ng-if="((vm.showFormErrors && vm.queryForm.$touched) || vm.queryForm.ssn.$touched) && vm.queryForm.ssn.$error.pattern">Improper format (XXX-XX-XXXX)</div>
              </div>
            </div>
            <div>
              <label for="telephone" class="col-sm-2 control-label">Telephone</label>
              <div class="col-sm-4">
                <input class="input-sm form-control" type="text" ng-model="vm.query.telephone" id="telephone" name="telephone"
                       ng-keyup="$event.keyCode == 13 && !vm.queryForm.$invalid && vm.searchForPatient()">
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label">Addresses</label>
            <div class="col-sm-10">
              <ai-addresses addresses="vm.query.addresses"
                            submit-form="vm.searchForPatient"></ai-addresses>
            </div>
          </div>
        </div>
      </div>
      <div class="panel-footer slide" ng-if="!vm.hidePanel">
        <div class="form-group">
          <div class="col-sm-4 col-sm-offset-4">
            <button ng-disabled="vm.queryForm.$invalid && vm.showFormErrors"
                    class="btn btn-success btn-block"
                    id="queryFormSubmit"
                    ng-mouseover="vm.showFormErrors = true"
                    ng-focus="vm.showFormErrors = true"
                    ng-click="vm.searchForPatient()">Search <i class="fa fa-search"></i></button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
